
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>perInfoImprove</title>
    <link rel="stylesheet" href="../public/public-css/css-clear.css">
    <link rel="stylesheet" href="../lib/bootstrap-3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../lib/animate.css-3.5.0/animate.min.css">
    <link rel="stylesheet" href="../lib/My97DatePicker-4.8/skin/WdatePicker.css">
    <link rel="stylesheet" href="../public/public-header/header.css">
    <link rel="stylesheet" href="../css/perInfoImprove.css">
    <link rel="stylesheet" href="../public/public-footer/footer.css">
    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--  条件注释的作用：当判断条件满足时候jiu执行注释中html代码，如果条件不满足时候那这就是一个注释 -->
    <!--[if lt IE 9]>
        <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
</head>

<body>
    <!-- header 头部导航及登录 -->
    <header id="header"></header>
    <!-- /导航及登录结束 -->
    <!-- 信息板块 -->
    <section class="basic_infor wow fadeIn">
        <div class="container">
            <div class="row">
                <div class="col-md-offset-2 col-md-6">
                    <span class="spn_title">基本资料</span>
                    <div class="personal_infor">
                        <!-- 这个空的div是为了做一个阴影效果  并且设置下边距 控制元素之间距离 -->
                    </div>
                    <form class="form-horizontal">
                        <!--昵称及姓名区域-->
                        <!-- nick_name 昵称的class名 -->
                        <div class="form-group nick_name">
                            <label for="nickName" class="col-sm-2 control-label">昵称:</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="nickName" placeholder="请输入您的昵称">
                            </div>
                        </div>
                        <!-- per_name 这是姓名这个板块的class名 -->
                        <div class="form-group per_name">
                            <label for="name" class="col-sm-2 control-label">姓名:</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="name" placeholder="请输入您的姓名" pattern="^[\u4e00-\u9fa5 ]{2,20}$">
                            </div>
                        </div>
                        <!-- 昵称和姓名区域结束-->
                        <!--  sex_style_left 这个类名是为了保证在任何宽度的屏幕下 性别和下拉框都能和前面的姓名 昵称对应照齐 -->
                        <div class="col-xs-offset-1 sex_style_left">
                            <!-- per_sex是性别这个板块的class名 -->
                            <div class="form-group form-inline per_sex">
                                <label for="sex">
                                    &nbsp性别:
                                    <!-- custom-marginL 这个类名 是为了让 男 女 这两个字 不紧贴姓名 设置的单独的样式 -->
                                    <input type="radio" name="sex" class="custom-marginL" value="男"> 男
                                    <input type="radio" name="sex" class="custom-marginW" value="女"> 女
                                </label>
                            </div>
                            <!-- 下拉框区域 -->
                            <!--   grade_major 年级及专业板块的class名-->
                            <div class="form-group form-inline grade_major">
                                <label for="grade" class="hidden-xs">
                                    &nbsp年级:
                                    <select class="form-control" id="grade">
                                        <option value="0">--请选择--</option>
                                    </select>

                                    <label for="custom-marginR" class="custom-marginR hidden-xs">
                                        专业方向:
                                        <select class="form-control" id="custom-marginR">
                                            <option value="00">--请选择--</option>
                                        </select>
                                    </label>
                            </div>
                            <!--  per_birthday 生日板块的class名-->
                            <div class="form-group form-inline per_birthday">
                                <label for="birthdayDay" class="hidden-xs">
                                    生日:
                                    <input class="form-control Wdate birthdayYear" onclick="WdatePicker({dateFmt:'yyyy年MM月dd日',isShowClear:false,vel:'hiddenBirthday'})"
                                           id="birthday">
                                    <input id="hiddenBirthday" type="text" hidden="hidden" />
                                </label>
                            </div>
                            <!-- 下拉框区域结束 -->
                        </div>
                        <div class="personal_infor">
                            <!-- 这个空的div是为了做一个阴影效果  并且设置下边距 控制元素之间距离 -->
                        </div>
                        <!-- 联系方式区域-->
                        <!--per_phone 手机号板块 -->
                        <div class="form-group per_phone">
                            <label for="phone" class="col-sm-2 control-label">手机:</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="phone" placeholder="请输入您的手机号" pattern="^1(3|4|5|7|8)\d{9}$">
                            </div>
                        </div>
                        <!-- per_wechat 微信板块-->
                        <div class="form-group per_wechat">
                            <label for="weChat" class="col-sm-2 control-label">微信:</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="weChat" placeholder="请输入您的微信号" pattern="^[a-zA-Z]([-_a-zA-Z0-9]{5,19})+$">
                            </div>
                        </div>
                        <!-- per_qq QQ板块-->
                        <div class="form-group per_qq">
                            <label for="QQ" class="col-sm-2 control-label">QQ:</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="QQ" placeholder="请输入您的QQ号" pattern="[1-9][0-9]{4,14}">
                            </div>
                        </div>
                        <!-- per_mail 邮箱板块-->
                        <div class="form-group per_mail">
                            <label for="email" class="col-sm-2 control-label">邮箱:</label>
                            <div class="col-sm-10">
                                <input type="email" class="form-control" id="email" placeholder="请输入您的邮箱" pattern="^[a-zA-Z0-9_.-]+@{@Html.Raw("@");}[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$">
                            </div>
                        </div>
                        <!--联系方式区域结束 -->
                        <div class="personal_infor">
                            <!-- 这个空的div是为了做一个阴影效果  并且设置下边距 控制元素之间距离 -->
                        </div>
                        <!-- per_hobby 爱好板块 -->
                        <div class="form-group per_hobby">
                            <label for="hobby" class="col-sm-2 control-label" style="padding-right:0">兴趣爱好:</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="hobby" placeholder="请输入你的兴趣爱好">
                            </div>
                        </div>
                        <!-- home_address 家庭住址板块 -->
                        <div class="form-group home_address">
                            <label for="address" class="col-sm-2 control-label" style="padding-right:0">家庭住址:</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="address" placeholder="请输入您的家庭住址">
                            </div>
                        </div>
                        <!-- per_profile 个人简介板块 -->
                        <div class="form-group per_profile">
                            <label for="introduce" class="col-sm-2 control-label" style="padding-right:0">个人简介:</label>
                            <div class="col-sm-10">
                                <textarea class="form-control" rows="3" style="resize:none" placeholder="请介绍一下您自己" id="profile"></textarea>
                            </div>
                        </div>
                        <div class="row">
                            <button type="button" class="btn btn-lg btn-primary center-block" id="saveBtn"> &nbsp&nbsp保存&nbsp&nbsp </button>
                        </div>
                    </form>
                </div>

                <div class="col-md-3 hidden-sm hidden-xs image-editor">
                    <!-- 头像的class名 为 per_portrait -->
                    <div class="cropit-preview center-block per_portrait"></div>
                    <input type="file" name="logo" class="cropit-image-input" style="display:none">
                    <button class="btn btn-primary center-block select-image-btn">选择头像</button>
                    <button class="btn btn-primary center-block export" style="margin-top:10px;">上传头像</button>
                    <img src="" alt="头像剪切图" class="userLogoImg" style="display: none;">
                </div>

            </div>
        </div>
    </section>

    <!-- /信息板块结束 -->
    <!-- 脚注部分 -->
    <footer id="footer"></footer>
    <!-- /脚注部分结束 -->
</body>
<script src="../lib/jquery-2.1.4/jquery.min.js"></script>
<script src="../lib/bootstrap-3.3.7/js/bootstrap.min.js"></script>
<script src="../lib/wow-1.1.2/wow.min.js"></script>
<script src="../lib/cropit.js-0.5.1/jquery.cropit.js"></script>
<script language="javascript" type="text/javascript" src="../lib/My97DatePicker-4.8/WdatePicker.js"></script>
<script src="../public/public-header/header.js"></script>
<script src="../js/perInfoImprove.js"></script>
<script src="../public/public-footer/footer.js"></script>
<script>
    $(function () {
        // 个人信息完善页面AJAX交互
        //先获取后台返回的数据，填充页面文本
        $.ajax({
            async: true,
            beforeSend: function () { },
            complete: function () { },
            url: "/PerIntroduce/GetPerInfo",
            type: "GET",
            dataType: "json",
            success: function (data) {
                var data = JSON.stringify(data);
                data = JSON.parse(data);
                //调用DOM操作函数
                init(data);
            },
            error: function (data) {
                console.log(data.status, data.statusText);
            }
        });

        //单独封装的时间转化函数
        function timeChage(time) {
            //把时间转换一下格式，年 月 日
            var date = new Date(time);
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var day = date.getDate();
            var timeEnd = year + '年' + month + '月' + day + '日';
            return timeEnd;
        }
        //封装DOM操作
        //封装后台返回的文本的填充操作
        function init(data) {
            //设置昵称
            if (data.nickName == null) {
                return false;
            } else {
                $('.basic_infor .nick_name #nickName').val(data.nickName);
            }
            //设置姓名
            if (data.name == null) {
                return false;
            } else {
                $('.basic_infor .per_name #name').val(data.name);
            }
            //设置性别
            if (data.gender == null) {
                return false;
            }
            else if (data.gender == "男") {
                $('.basic_infor .sex_style_left .per_sex .custom-marginL').attr('checked', 'checked');
            } else {
                $('.basic_infor .sex_style_left .per_sex .custom-marginW').attr('checked', 'checked');
            }
            //设置年级和专业方向
            if (data.grade == null) {
                return false;
            } else {
                $('.basic_infor .sex_style_left .grade_major #grade option').eq(0).text(data.grade);
            }
            if (data.major == null) {
                return false;
            } else {
                $('.basic_infor .sex_style_left .grade_major #custom-marginR option').eq(0).text(data.major);
            }
            //设置生日
            if (data.birthday == null) {
                return false;
            } else {
                var birthday = timeChage(data.birthday);
                $('.basic_infor .sex_style_left .per_birthday #birthday').val(birthday);
            }
            //设置手机号
            if (data.phone == null) {
                return false;
            } else {
                $('.basic_infor .per_phone #phone').val(data.phone);
            }
            //设置微信号
            if (data.wechat == null) {
                return false;
            } else {
                $('.basic_infor .per_wechat #weChat').val(data.wechat);
            }
            //设置QQ号
            if (data.QQ == null) {
                return false;
            } else {
                $('.basic_infor .per_qq #QQ').val(data.QQ);
            }
            //设置邮箱账号
            if (data.Email == null) {
                return false;
            } else {
                $('.basic_infor .per_mail #email').val(data.Email);
            }
            //设置兴趣爱好
            if (data.hobby == null) {
                return false;
            } else {
                $('.basic_infor .per_hobby #hobby').val(data.hobby);
            }
            //设置家庭住址
            if (data.address == null) {
                return false;
            } else {
                $('.basic_infor .home_address #address').val(data.address);
            }
            //设置个人简介
            if (data.introduce == null) {
                return false;
            } else {
                $('.basic_infor .per_profile #profile').val(data.introduce);
            }
        }

        //点击保存发送数据
        //声明一个object类型的变量
        var perInfo = new Object();
        $('.basic_infor #saveBtn').on('click', function () {
            perInfo.nickName = $('.basic_infor .nick_name #nickName').val();
            perInfo.name = $('.basic_infor .per_name #name').val();
            perInfo.gender = $('input:radio:checked').val();
            perInfo.grade = $('.basic_infor .sex_style_left .grade_major #grade option:checked').text();
            perInfo.major = $('.basic_infor .sex_style_left .grade_major #custom-marginR option:checked').text();
            perInfo.birthday = $('.basic_infor .sex_style_left .per_birthday #hiddenBirthday').val();
            perInfo.phone = $('.basic_infor .per_phone #phone').val();
            perInfo.wechat = $('.basic_infor .per_wechat #weChat').val();
            perInfo.Email = $('.basic_infor .per_mail #email').val();
            perInfo.QQ = $('.basic_infor .per_qq #QQ').val();
            perInfo.hobby = $('.basic_infor .per_hobby #hobby').val();
            perInfo.address = $('.basic_infor .home_address #address').val();
            perInfo.introduce = $('.basic_infor .per_profile #profile').val();
            $.ajax({
                async: true,
                beforeSend: function () { },
                complete: function () { },
                url: "/PerIntroduce/AddPerIntroduce",
                type: "POST",
                data: {
                    perInfoJson: JSON.stringify(perInfo)
                },
                dataType: "json",
                success: function (message) {
                    if (message.status == 'ok') {
                        alert('保存成功');
                    } else {
                        alert('保存失败' + message.jsonTxt);
                    }
                },
                error: function (message) {
                    console.log(message.status, message.statusText);
                }
            });
        });
        //点击上传头像，发送AJAX
        $('.basic_infor .image-editor .export').on('click', function () {
            if ($('.basic_infor .image-editor .userLogoImg').attr('src') == "") {
                alert('还没选择图片呢');
            } else {
                $.ajax({
                    async: true,
                    beforeSend: function () { },
                    complete: function () { },
                    url: "/PerIntroduce/AddUserLogo",
                    type: "POST",
                    data: {
                        userLogo: $('.basic_infor .image-editor .userLogoImg').attr('src')
                    },
                    dataType: "json",
                    success: function (data) {
                        if (data.status == 'ok') {
                            alert('上传成功');
                        } else {
                            alert('上传失败' + data.jsonTxt);
                        }
                    },
                    error: function (data) {
                        console.log(data.status, data.statusText);
                    }
                });
            }
        });
    });
</script>

</html>